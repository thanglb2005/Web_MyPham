<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thống Kê Doanh Thu - OneShop Admin</title>
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/assets/css/atlantis.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Thêm các thư viện để xuất báo cáo -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Animate.css để thêm hiệu ứng -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <!-- Enhanced Chart Icons Styling -->
    <link rel="stylesheet" href="/css/chart-icon-enhancements.css" />
    <!-- Enhanced Layout Optimization -->
    <link rel="stylesheet" href="/css/revenue-layout-optimization.css" />
    <style>
        /* Card Styling */
        .card-stats:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .card {
            transition: all 0.3s ease;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            border: none;
        }
        .card-header {
            background: linear-gradient(45deg, #1572E8, #41B1F9);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 15px 20px;
            border-bottom: none;
        }
        .card-title {
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            font-size: 1.1rem;
        }
        .card-body {
            padding: 20px;
        }
        .dashboard-item {
            transition: all 0.3s ease;
            padding: 0.5rem;
        }
        .dashboard-item .card-body {
            position: relative;
        }
        .dashboard-stats {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: #444;
        }
        .fw-bold {
            font-weight: 600 !important;
        }
        .bubble-shadow-small {
            position: relative;
            display: inline-block;
            margin-right: 15px;
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            border-radius: 50%;
        }
        .icon-primary {
            background: linear-gradient(45deg, #1572E8, #41B1F9);
            color: white;
        }
        .icon-success {
            background: linear-gradient(45deg, #31CE36, #78E285);
            color: white;
        }
        .icon-info {
            background: linear-gradient(45deg, #48ABF7, #88C3FA);
            color: white;
        }
        .icon-warning {
            background: linear-gradient(45deg, #FFAD46, #FFD271);
            color: white;
        }
        .bubble-shadow-small:after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: inherit;
            opacity: 0.3;
            filter: blur(3px);
            z-index: -1;
            left: -2px;
            bottom: -3px;
        }
        
        .dashboard-item {
            margin-bottom: 20px;
        }
        
        .dashboard-item:hover {
            transform: scale(1.02);
        }
        
        /* Table Styling */
        .comparison-table {
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .comparison-table th {
            background-color: #f8f9fa;
            color: #1a2035;
            font-weight: 600;
            padding: 15px;
            border-bottom: 2px solid #eaeaea;
        }
        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #f2f2f2;
        }
        .comparison-table tr:hover td {
            background-color: #f9f9f9;
        }
        .table-success td {
            background-color: rgba(49, 206, 54, 0.1) !important;
        }
        
        /* Chart Styling */
        .chart-container {
            position: relative;
            margin: auto;
            height: 60vh;
            width: 100%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border-radius: 15px;
            padding: 20px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .chart-container:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 50vh;
                padding: 15px;
            }
        }
        
        /* Button Styling */
        .filter-btn {
            border-radius: 20px;
            margin: 5px;
            font-weight: 500;
            box-shadow: 0 3px 5px rgba(0,0,0,0.1);
        }
        .btn-modern {
            border-radius: 50px;
            padding: 10px 25px;
            font-weight: 600;
            letter-spacing: 0.7px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            text-transform: uppercase;
            font-size: 0.9rem;
        }
        .btn-modern:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }
        .btn-modern i {
            margin-right: 8px;
        }
        
        /* Chart Type Button Styling */
        .btn-circle.chart-type {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            padding: 0;
            margin: 0 5px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background: white;
            color: #1572E8;
            border: 2px solid #eaeaea;
        }
        
        .btn-circle.chart-type:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            background: #f8f9fa;
        }
        
        .btn-circle.chart-type.active {
            background: #1572E8;
            color: white;
            border-color: #1572E8;
            box-shadow: 0 4px 10px rgba(21, 114, 232, 0.4);
        }
        
        /* Text Styling */
        .dashboard-stats {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .trend-indicator {
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 5px;
            display: inline-block;
            animation: pulse 1.5s infinite;
        }
        
        /* Chart Type Controls */
        .chart-controls {
            margin-bottom: 15px;
            position: relative;
            z-index: 5;
        }
        .chart-type-container {
            display: flex;
            gap: 10px;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 50px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            justify-content: center;
            margin-bottom: 20px;
        }
        .btn-circle {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #6c757d;
        }
        .btn-circle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            color: #007bff;
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.05);
        }
        .btn-circle.active {
            background-color: #007bff;
            border-color: #007bff;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }
        .btn-circle i {
            font-size: 1rem;
        }
        
        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Gradient backgrounds for cards */
        .card-primary.card-round .card-body {
            background: linear-gradient(45deg, #1572E8, #41B1F9);
        }
        .card-success.card-round .card-body {
            background: linear-gradient(45deg, #31CE36, #8ff25b);
        }
        .card-info.card-round .card-body {
            background: linear-gradient(45deg, #48ABF7, #0ddeff);
        }
        .card-warning.card-round .card-body {
            background: linear-gradient(45deg, #FFAD46, #ffe5bc);
        }
        .card-round .card-body {
            color: white;
            border-radius: 10px;
        }
        
        /* Add subtle hover effects for table rows */
        .revenue-row:hover, .orders-row:hover, .avg-row:hover {
            background-color: #f8fcff;
        }
        
        /* Card footer styling */
        .card-footer {
            padding: 10px 15px;
            border-top: 1px solid rgba(0,0,0,0.05);
            background-color: #fcfcfc;
        }
        
        /* Table styling enhancements */
        .table {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0,0,0,0.03);
            margin-bottom: 2rem;
        }
        
        .table thead th {
            border-top: none;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            padding: 12px 15px;
            vertical-align: middle;
            background: linear-gradient(45deg, #1572E8, #41B1F9);
            color: white;
            border-bottom: none;
        }
        
        .table tbody tr:hover {
            background-color: rgba(21, 114, 232, 0.05);
        }
        
        .table tbody td {
            vertical-align: middle;
            padding: 12px 15px;
            border-color: #f2f2f2;
        }
        
        .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(0,0,0,0.01);
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <!-- Header -->
        <th:block th:replace="~{admin/fragments/header :: header}"></th:block>
        
        <!-- Navbar -->
        <th:block th:replace="~{admin/fragments/navbar :: navbar}"></th:block>
        
        <div class="main-panel">
            <div class="content">
                <div class="page-inner">
                    <div class="page-header">
                        <h4 class="page-title">Thống Kê Doanh Thu</h4>
                        <ul class="breadcrumbs">
                            <li class="nav-home">
                                <a href="/admin">
                                    <i class="flaticon-home"></i>
                                </a>
                            </li>
                            <li class="separator">
                                <i class="flaticon-right-arrow"></i>
                            </li>
                            <li class="nav-item">
                                <a href="#">Thống Kê Doanh Thu</a>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Filter Options -->
                    <div class="row mb-4 animate__animated animate__fadeIn">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title"><i class="fas fa-filter"></i> Lọc theo loại báo cáo</h4>
                                </div>
                                <div class="card-body">
                                    <!-- Thêm bộ lọc theo khoảng thời gian -->
                                    <form id="date-filter-form" class="mb-3" method="get" action="">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label><i class="fas fa-calendar"></i> Từ ngày:</label>
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text bg-primary text-white"><i class="fas fa-calendar-alt"></i></span>
                                                        </div>
                                                        <input type="date" class="form-control" name="startDate" id="startDate" th:value="${startDate}">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label><i class="fas fa-calendar-check"></i> Đến ngày:</label>
                                                    <div class="input-group">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text bg-primary text-white"><i class="fas fa-calendar-alt"></i></span>
                                                        </div>
                                                        <input type="date" class="form-control" name="endDate" id="endDate" th:value="${endDate}">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 d-flex align-items-end">
                                                <button type="submit" class="btn btn-info mr-2 btn-modern">
                                                    <i class="fas fa-filter"></i> Lọc báo cáo
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary btn-modern" id="reset-filter">
                                                    <i class="fas fa-undo"></i> Đặt lại
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                    
                                    <script>
                                        // Keep form action synchronized with current page
                                        document.addEventListener('DOMContentLoaded', function() {
                                            var form = document.getElementById('date-filter-form');
                                            if (form) {
                                                // Set form action to current URL (without query params)
                                                var currentPath = window.location.pathname;
                                                form.action = currentPath;
                                            }
                                            
                                            // Reset filter button
                                            document.getElementById('reset-filter').addEventListener('click', function() {
                                                window.location.href = window.location.pathname;
                                            });
                                        });
                                    </script>
                                    <div class="d-flex flex-wrap justify-content-around animate__animated animate__fadeIn">
                                        <a href="/admin/revenue-statistics" class="btn btn-primary mb-2 filter-btn animate__animated animate__pulse">
                                            <i class="fas fa-chart-line"></i> Tổng quan
                                        </a>
                                        <a href="/admin/report-products" class="btn btn-info mb-2 filter-btn">
                                            <i class="fas fa-box"></i> Theo sản phẩm
                                        </a>
                                        <a href="/admin/report-categories" class="btn btn-success mb-2 filter-btn">
                                            <i class="fas fa-list"></i> Theo danh mục
                                        </a>
                                        <a href="/admin/report-brands" class="btn btn-warning mb-2 filter-btn">
                                            <i class="fas fa-copyright"></i> Theo thương hiệu
                                        </a>
                                        <a href="/admin/report-years" class="btn btn-secondary mb-2 filter-btn">
                                            <i class="fas fa-calendar-alt"></i> Theo năm
                                        </a>
                                        <a href="/admin/report-months" class="btn btn-danger mb-2 filter-btn">
                                            <i class="fas fa-calendar-day"></i> Theo tháng
                                        </a>
                                        <a href="/admin/report-quarters" class="btn btn-dark mb-2 filter-btn">
                                            <i class="fas fa-calendar-week"></i> Theo quý
                                        </a>
                                        <a href="/admin/report-users" class="btn btn-primary mb-2 filter-btn">
                                            <i class="fas fa-users"></i> Theo khách hàng
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Statistics Dashboard -->
                    <div class="row" th:if="${reportData == null}">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">Tổng quan doanh thu</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <!-- KPIs -->
                                        <div class="col-sm-6 col-md-3 dashboard-item animate__animated animate__fadeIn">
                                            <div class="card card-stats card-primary card-round">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-5">
                                                            <div class="icon-big text-center">
                                                                <i class="fas fa-shopping-cart"></i>
                                                            </div>
                                                        </div>
                                                        <div class="col-7 col-stats">
                                                            <div class="numbers">
                                                                <p class="card-category">Đơn hàng hôm nay</p>
                                                                <h4 class="card-title dashboard-stats" th:text="${todayOrders ?: '0'}">0</h4>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-footer p-2">
                                                    <div class="text-center">
                                                        <small class="text-muted"><i class="fas fa-info-circle"></i> Đơn hàng mới trong 24h qua</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-md-3 dashboard-item animate__animated animate__fadeIn animate__delay-1s">
                                            <div class="card card-stats card-success card-round">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-5">
                                                            <div class="icon-big text-center">
                                                                <i class="fas fa-dollar-sign"></i>
                                                            </div>
                                                        </div>
                                                        <div class="col-7 col-stats">
                                                            <div class="numbers">
                                                                <p class="card-category">Doanh thu hôm nay</p>
                                                                <h4 class="card-title dashboard-stats" th:text="${todayRevenue ?: '0 ₫'}">0 ₫</h4>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-footer p-2">
                                                    <div class="text-center">
                                                        <small class="text-muted"><i class="fas fa-clock"></i> Cập nhật liên tục</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-md-3 dashboard-item animate__animated animate__fadeIn animate__delay-2s">
                                            <div class="card card-stats card-info card-round">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-5">
                                                            <div class="icon-big text-center">
                                                                <i class="fas fa-chart-bar"></i>
                                                            </div>
                                                        </div>
                                                        <div class="col-7 col-stats">
                                                            <div class="numbers">
                                                                <p class="card-category">Doanh thu tháng này</p>
                                                                <h4 class="card-title dashboard-stats" th:text="${currentMonthRevenue ?: '0 ₫'}">0 ₫</h4>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-footer p-2">
                                                    <div class="text-center">
                                                        <small class="text-muted"><i class="fas fa-calendar-alt"></i> Tháng <span th:text="${#dates.format(#dates.createNow(), 'MM/yyyy')}">10/2025</span></small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-md-3 dashboard-item animate__animated animate__fadeIn animate__delay-3s">
                                            <div class="card card-stats card-warning card-round">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-5">
                                                            <div class="icon-big text-center">
                                                                <i class="fas fa-chart-line"></i>
                                                            </div>
                                                        </div>
                                                        <div class="col-7 col-stats">
                                                            <div class="numbers">
                                                                <p class="card-category">Tỷ lệ tăng trưởng</p>
                                                                <h4 class="card-title dashboard-stats">
                                                                    <span th:class="${isPositiveGrowth ? 'text-white' : 'text-white'}">
                                                                        <i th:class="${isPositiveGrowth ? 'fas fa-arrow-up' : 'fas fa-arrow-down'}"></i>
                                                                        <span th:text="${growthRate ?: '0%'}">0%</span>
                                                                        <span class="trend-indicator" th:classappend="${isPositiveGrowth ? 'bg-success' : 'bg-danger'}">
                                                                            <i th:class="${isPositiveGrowth ? 'fas fa-thumbs-up' : 'fas fa-thumbs-down'}"></i>
                                                                        </span>
                                                                    </span>
                                                                </h4>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-footer p-2">
                                                    <div class="text-center">
                                                        <small class="text-muted"><i class="fas fa-sync-alt"></i> So với tháng trước</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- So sánh doanh thu giữa các kỳ -->
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <div class="card animate__animated animate__fadeIn animate__delay-1s">
                                                <div class="card-header">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-balance-scale fa-2x mr-2"></i>
                                                        <h4 class="card-title mb-0">So sánh doanh thu giữa các kỳ</h4>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label><i class="fas fa-sliders-h"></i> Chọn loại so sánh:</label>
                                                                <div class="input-group">
                                                                    <div class="input-group-prepend">
                                                                        <span class="input-group-text bg-primary text-white"><i class="fas fa-exchange-alt"></i></span>
                                                                    </div>
                                                                    <select class="form-control" id="comparison-type">
                                                                        <option value="month">Tháng so với tháng trước</option>
                                                                        <option value="quarter">Quý so với quý trước</option>
                                                                        <option value="year">Năm so với năm trước</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-group" id="period-selector">
                                                                <label><i class="fas fa-calendar-check"></i> Chọn kỳ:</label>
                                                                <div class="input-group">
                                                                    <div class="input-group-prepend">
                                                                        <span class="input-group-text bg-info text-white"><i class="fas fa-calendar"></i></span>
                                                                    </div>
                                                                    <select class="form-control" id="period-value">
                                                                        <!-- Tùy chọn sẽ được tạo động bằng JavaScript -->
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 d-flex align-items-end">
                                                            <button class="btn btn-primary btn-modern" id="compare-periods">
                                                                <i class="fas fa-sync"></i> So sánh
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="row mt-4">
                                                        <div class="col-md-12">
                                                            <div id="comparison-result" style="display: none;" class="animate__animated animate__fadeIn">
                                                                <div class="table-responsive">
                                                                    <table class="table table-bordered table-hover comparison-table">
                                                                        <thead class="bg-light">
                                                                            <tr>
                                                                                <th class="text-center"><i class="fas fa-chart-pie"></i> Chỉ tiêu</th>
                                                                                <th class="text-center" id="current-period"><i class="fas fa-calendar-check"></i> Kỳ hiện tại</th>
                                                                                <th class="text-center" id="previous-period"><i class="fas fa-calendar-minus"></i> Kỳ trước</th>
                                                                                <th class="text-center"><i class="fas fa-exchange-alt"></i> Chênh lệch</th>
                                                                                <th class="text-center"><i class="fas fa-percentage"></i> Tỷ lệ (%)</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr class="revenue-row">
                                                                                <td><i class="fas fa-dollar-sign text-success mr-1"></i> <strong>Doanh thu</strong></td>
                                                                                <td class="text-right font-weight-bold" id="current-revenue">0 ₫</td>
                                                                                <td class="text-right" id="previous-revenue">0 ₫</td>
                                                                                <td class="text-right" id="revenue-diff">0 ₫</td>
                                                                                <td class="text-center" id="revenue-rate">0%</td>
                                                                            </tr>
                                                                            <tr class="orders-row">
                                                                                <td><i class="fas fa-shopping-cart text-primary mr-1"></i> <strong>Số đơn hàng</strong></td>
                                                                                <td class="text-right font-weight-bold" id="current-orders">0</td>
                                                                                <td class="text-right" id="previous-orders">0</td>
                                                                                <td class="text-right" id="orders-diff">0</td>
                                                                                <td class="text-center" id="orders-rate">0%</td>
                                                                            </tr>
                                                                            <tr class="avg-row">
                                                                                <td><i class="fas fa-calculator text-warning mr-1"></i> <strong>Giá trị trung bình mỗi đơn</strong></td>
                                                                                <td class="text-right font-weight-bold" id="current-avg">0 ₫</td>
                                                                                <td class="text-right" id="previous-avg">0 ₫</td>
                                                                                <td class="text-right" id="avg-diff">0 ₫</td>
                                                                                <td class="text-center" id="avg-rate">0%</td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                            <div id="comparison-placeholder" class="text-center py-4">
                                                                <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
                                                                <p class="text-muted">Chọn loại so sánh và nhấn nút "So sánh" để xem kết quả</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    </div>

                                    <!-- Chart Container -->
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="card animate__animated animate__fadeIn animate__delay-2s">
                                                <div class="card-header">
                                                    <div class="d-flex align-items-center justify-content-between">
                                                        <div class="d-flex align-items-center">
                                                            <i class="fas fa-chart-line fa-2x mr-2"></i>
                                                            <div class="card-title mb-0">Biểu đồ doanh thu theo tháng</div>
                                                        </div>
                                                        <div class="chart-controls">
                                                            <div class="chart-type-container text-center">
                                                                <div class="d-inline-flex">
                                                                    <button type="button" class="btn btn-circle chart-type btn-outline-primary" data-type="line" id="chart-type-line" title="Biểu đồ đường">
                                                                        <i class="fas fa-chart-line"></i>
                                                                    </button>
                                                                    <button type="button" class="btn btn-circle chart-type active btn-primary" data-type="bar" id="chart-type-bar" title="Biểu đồ cột">
                                                                        <i class="fas fa-chart-bar"></i>
                                                                    </button>
                                                                    <button type="button" class="btn btn-circle chart-type btn-outline-primary" data-type="pie" id="chart-type-pie" title="Biểu đồ tròn">
                                                                        <i class="fas fa-chart-pie"></i>
                                                                    </button>
                                                                    <button type="button" class="btn btn-circle chart-type btn-outline-primary" data-type="doughnut" id="chart-type-doughnut" title="Biểu đồ vòng">
                                                                        <i class="fas fa-circle-notch"></i>
                                                                    </button>
                                                                </div>
                                                                <div class="mt-2 text-muted">
                                                                    <small>Chọn loại biểu đồ bạn muốn hiển thị</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <div class="chart-container shadow-sm rounded">
                                                        <canvas id="revenueChart"></canvas>
                                                    </div>
                                                </div>
                                                <div class="card-footer bg-white border-top">
                                                    <div class="text-center text-muted">
                                                        <small><i class="fas fa-info-circle"></i> Di chuyển chuột trên biểu đồ để xem chi tiết</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Report Data Table -->
                    <div class="row" th:if="${reportData != null}">
                        <div class="col-md-12">
                            <div class="card shadow-sm animate__animated animate__fadeIn">
                                <div class="card-header">
                                    <div class="d-flex align-items-center">
                                        <div class="icon-big text-center icon-info bubble-shadow-small mr-3">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <h4 class="card-title mb-0 font-weight-bold" th:text="${reportTitle}">Thống kê báo cáo</h4>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <!-- Nút xuất báo cáo -->
                                    <div class="mb-4 d-flex justify-content-between align-items-center bg-light p-3 rounded">
                                        <h5 class="text-muted mb-0"><i class="fas fa-calendar-alt"></i> Báo cáo được tạo ngày <span th:text="${#dates.format(#dates.createNow(), 'dd/MM/yyyy')}" class="font-weight-bold text-primary">07/10/2025</span></h5>
                                        <div>
                                            <button id="export-excel" class="btn btn-success mr-2 btn-modern">
                                                <i class="fas fa-file-excel"></i> Xuất Excel
                                            </button>
                                            <div class="btn-group">
                                                <button id="export-pdf" class="btn btn-danger btn-modern">
                                                    <i class="fas fa-file-pdf"></i> Xuất PDF
                                                </button>
                                                <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <span class="sr-only">Tùy chọn</span>
                                                </button>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#" id="export-pdf-text">PDF (Text - nhanh)</a>
                                                    <a class="dropdown-item" href="#" id="export-pdf-image">PDF (Hình ảnh - font đẹp)</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Tóm tắt báo cáo - Thẻ thông tin -->
                                    <div class="row mb-4" id="report-summary">
                                        <!-- Tổng số mục -->
                                        <div class="col-lg-3 col-md-6 col-sm-6 dashboard-item">
                                            <div class="card card-stats card-primary card-round animate__animated animate__fadeIn">
                                                <div class="card-body pb-0">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-big text-center icon-primary bubble-shadow-small">
                                                            <i class="fas fa-chart-bar"></i>
                                                        </div>
                                                        <div class="ml-3 w-100">
                                                            <h5 class="card-title fw-bold">Tổng số mục</h5>
                                                            <h2 class="dashboard-stats mb-0" id="summary-total-items">0</h2>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-footer">
                                                    <div class="text-center pt-1">
                                                        <small class="text-muted"><i class="fas fa-info-circle"></i> Mục đã phân tích</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Tổng doanh thu -->
                                        <div class="col-lg-3 col-md-6 col-sm-6 dashboard-item">
                                            <div class="card card-stats card-success card-round animate__animated animate__fadeIn animate__delay-1s">
                                                <div class="card-body pb-0">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-big text-center icon-success bubble-shadow-small">
                                                            <i class="fas fa-dollar-sign"></i>
                                                        </div>
                                                        <div class="ml-3 w-100">
                                                            <h5 class="card-title fw-bold">Tổng doanh thu</h5>
                                                            <h2 class="dashboard-stats mb-0" id="summary-total-revenue">0 ₫</h2>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-footer">
                                                    <div class="text-center pt-1">
                                                        <small class="text-muted"><i class="fas fa-calendar"></i> <span th:text="${#dates.format(#dates.createNow(), 'dd/MM/yyyy')}">07/10/2025</span></small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Tổng số lượng -->
                                        <div class="col-lg-3 col-md-6 col-sm-6 dashboard-item">
                                            <div class="card card-stats card-info card-round animate__animated animate__fadeIn animate__delay-2s">
                                                <div class="card-body pb-0">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-big text-center icon-info bubble-shadow-small">
                                                            <i class="fas fa-shopping-cart"></i>
                                                        </div>
                                                        <div class="ml-3 w-100">
                                                            <h5 class="card-title fw-bold">Tổng số lượng</h5>
                                                            <h2 class="dashboard-stats mb-0" id="summary-total-quantity">0</h2>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-footer">
                                                    <div class="text-center pt-1">
                                                        <small class="text-muted"><i class="fas fa-box"></i> Sản phẩm đã bán</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Giá trung bình -->
                                        <div class="col-lg-3 col-md-6 col-sm-6 dashboard-item">
                                            <div class="card card-stats card-warning card-round animate__animated animate__fadeIn animate__delay-3s">
                                                <div class="card-body pb-0">
                                                    <div class="d-flex align-items-center">
                                                        <div class="icon-big text-center icon-warning bubble-shadow-small">
                                                            <i class="fas fa-tag"></i>
                                                        </div>
                                                        <div class="ml-3 w-100">
                                                            <h5 class="card-title fw-bold">Giá trung bình</h5>
                                                            <h2 class="dashboard-stats mb-0" id="summary-avg-price">0 ₫</h2>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-footer">
                                                    <div class="text-center pt-1">
                                                        <small class="text-muted"><i class="fas fa-calculator"></i> Giá trị trung bình mỗi đơn hàng</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover" id="report-table">
                                            <thead>
                                                <!-- Headers for regular reports -->
                                                <tr th:if="${reportType != null and reportType != 'users'}">
                                                    <th>#</th>
                                                    <th th:if="${reportType == 'products'}">Sản phẩm</th>
                                                    <th th:if="${reportType == 'categories'}">Danh mục</th>
                                                    <th th:if="${reportType == 'brands'}">Thương hiệu</th>
                                                    <th th:if="${reportType == 'years'}">Năm</th>
                                                    <th th:if="${reportType == 'months'}">Tháng</th>
                                                    <th th:if="${reportType == 'quarters'}">Quý</th>
                                                    <th>Số lượng bán ra</th>
                                                    <th>Doanh thu</th>
                                                    <th>Giá trung bình</th>
                                                    <th>Giá thấp nhất</th>
                                                    <th>Giá cao nhất</th>
                                                </tr>
                                                
                                                <!-- Default headers when no report type is specified -->
                                                <tr th:if="${reportType == null}">
                                                    <th>#</th>
                                                    <th>Mục</th>
                                                    <th>Số lượng</th>
                                                    <th>Doanh thu</th>
                                                    <th>Giá trung bình</th>
                                                </tr>
                                                
                                                <!-- Headers for user report -->
                                                <tr th:if="${reportType == 'users'}">
                                                    <th>#</th>
                                                    <th>Khách hàng</th>
                                                    <th>Số đơn hàng</th>
                                                    <th>Tổng chi tiêu</th>
                                                    <th>Giá trị trung bình/đơn</th>
                                                    <th>Lần mua gần nhất</th>
                                                    <th>Trạng thái</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Product report - item[0]=product_id, item[1]=product_name, item[2]=total_quantity, 
                                                     item[3]=total_revenue, item[4]=avg_price, item[5]=min_price, item[6]=max_price -->
                                                <tr th:each="item, iState : ${reportData}" th:if="${reportType == 'products'}">
                                                    <td th:text="${iState.index + 1}"></td>
                                                    <td th:text="${item[1]}"></td> <!-- Product name -->
                                                    <td th:text="${item[2]}"></td> <!-- Quantity -->
                                                    <td th:text="${#numbers.formatDecimal(item[3], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Revenue -->
                                                    <td th:text="${#numbers.formatDecimal(item[4], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Avg price -->
                                                    <td th:text="${#numbers.formatDecimal(item[5], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Min price -->
                                                    <td th:text="${#numbers.formatDecimal(item[6], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Max price -->
                                                </tr>
                                                
                                                <!-- User report - item[0]=user_id, item[1]=name, item[2]=total_orders, 
                                                     item[3]=total_spent, item[4]=avg_order_value, item[5]=last_purchase_date, item[6]=customer_status -->
                                                <tr th:each="item, iState : ${reportData}" th:if="${reportType == 'users'}">
                                                    <td th:text="${iState.index + 1}"></td>
                                                    <td th:text="${item[1]}"></td> <!-- Customer name -->
                                                    <td th:text="${item[2]}"></td> <!-- Total orders (not quantity) -->
                                                    <td th:text="${#numbers.formatDecimal(item[3], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Total spent -->
                                                    <td th:text="${#numbers.formatDecimal(item[4], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Avg order value -->
                                                    <td th:text="${#dates.format(item[5], 'dd/MM/yyyy')}"></td> <!-- Last purchase date -->
                                                    <td>
                                                        <span th:class="${
                                                            item[6] == 'Khách hàng thường xuyên' ? 'badge badge-success' : 
                                                            item[6] == 'Khách hàng thỉnh thoảng' ? 'badge badge-warning' : 
                                                            'badge badge-danger'}" 
                                                              th:text="${item[6]}">
                                                        </span>
                                                    </td> <!-- Customer status -->
                                                </tr>
                                                
                                                <!-- Categories and Brands: name, quantity, revenue, avg, min, max -->
                                                <tr th:each="item, iState : ${reportData}" th:if="${reportType == 'categories' or reportType == 'brands'}">
                                                    <td th:text="${iState.index + 1}"></td>
                                                    <td th:text="${item[0]}"></td> <!-- Name -->
                                                    <td th:text="${item[1]}"></td> <!-- Quantity -->
                                                    <td th:text="${#numbers.formatDecimal(item[2], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Revenue -->
                                                    <td th:text="${#numbers.formatDecimal(item[3], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Avg -->
                                                    <td th:text="${#numbers.formatDecimal(item[4], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Min -->
                                                    <td th:text="${#numbers.formatDecimal(item[5], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Max -->
                                                </tr>
                                                
                                                <!-- Months: year, month, quantity, revenue, avg, min, max -->
                                                <tr th:each="item, iState : ${reportData}" th:if="${reportType == 'months'}">
                                                    <td th:text="${iState.index + 1}"></td>
                                                    <td th:text="'Tháng ' + ${item[1]} + '/' + ${item[0]}"></td> <!-- Format: Tháng M/YYYY -->
                                                    <td th:text="${item[2]}"></td> <!-- Quantity -->
                                                    <td th:text="${#numbers.formatDecimal(item[3], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Revenue -->
                                                    <td th:text="${#numbers.formatDecimal(item[4], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Avg -->
                                                    <td th:text="${#numbers.formatDecimal(item[5], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Min -->
                                                    <td th:text="${#numbers.formatDecimal(item[6], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Max -->
                                                </tr>
                                                
                                                <!-- Quarters: year, quarter, quantity, revenue, avg, min, max -->
                                                <tr th:each="item, iState : ${reportData}" th:if="${reportType == 'quarters'}">
                                                    <td th:text="${iState.index + 1}"></td>
                                                    <td th:text="'Quý ' + ${item[1]} + '/' + ${item[0]}"></td> <!-- Format: Quý Q/YYYY -->
                                                    <td th:text="${item[2]}"></td> <!-- Quantity -->
                                                    <td th:text="${#numbers.formatDecimal(item[3], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Revenue -->
                                                    <td th:text="${#numbers.formatDecimal(item[4], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Avg -->
                                                    <td th:text="${#numbers.formatDecimal(item[5], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Min -->
                                                    <td th:text="${#numbers.formatDecimal(item[6], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Max -->
                                                </tr>
                                                
                                                <!-- Years: year, quantity, revenue, avg, min, max -->
                                                <tr th:each="item, iState : ${reportData}" th:if="${reportType == 'years'}">
                                                    <td th:text="${iState.index + 1}"></td>
                                                    <td th:text="'Năm ' + ${item[0]}"></td> <!-- Format: Năm YYYY -->
                                                    <td th:text="${item[1]}"></td> <!-- Quantity -->
                                                    <td th:text="${#numbers.formatDecimal(item[2], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Revenue -->
                                                    <td th:text="${#numbers.formatDecimal(item[3], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Avg -->
                                                    <td th:text="${#numbers.formatDecimal(item[4], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Min -->
                                                    <td th:text="${#numbers.formatDecimal(item[5], 1, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'"></td> <!-- Max -->
                                                </tr>
                                                
                                                <!-- Default data when no report is loaded - MUST match column structure! -->
                                                <!-- For products (7 columns) -->
                                                <tr th:if="${(reportData == null or #lists.isEmpty(reportData)) and reportType == 'products'}">
                                                    <td>1</td>
                                                    <td>Sản phẩm mẫu</td>
                                                    <td>10</td>
                                                    <td>1,000,000 ₫</td>
                                                    <td>100,000 ₫</td>
                                                    <td>50,000 ₫</td>
                                                    <td>150,000 ₫</td>
                                                </tr>
                                                
                                                <!-- For categories/brands (7 columns) -->
                                                <tr th:if="${(reportData == null or #lists.isEmpty(reportData)) and (reportType == 'categories' or reportType == 'brands')}">
                                                    <td>1</td>
                                                    <td>Dữ liệu mẫu</td>
                                                    <td>10</td>
                                                    <td>1,000,000 ₫</td>
                                                    <td>100,000 ₫</td>
                                                    <td>50,000 ₫</td>
                                                    <td>150,000 ₫</td>
                                                </tr>
                                                
                                                <!-- For months/quarters (7 columns) -->
                                                <tr th:if="${(reportData == null or #lists.isEmpty(reportData)) and (reportType == 'months' or reportType == 'quarters')}">
                                                    <td>1</td>
                                                    <td>Dữ liệu mẫu</td>
                                                    <td>10</td>
                                                    <td>1,000,000 ₫</td>
                                                    <td>100,000 ₫</td>
                                                    <td>50,000 ₫</td>
                                                    <td>150,000 ₫</td>
                                                </tr>
                                                
                                                <!-- For years (7 columns) -->
                                                <tr th:if="${(reportData == null or #lists.isEmpty(reportData)) and reportType == 'years'}">
                                                    <td>1</td>
                                                    <td>Năm mẫu</td>
                                                    <td>10</td>
                                                    <td>1,000,000 ₫</td>
                                                    <td>100,000 ₫</td>
                                                    <td>50,000 ₫</td>
                                                    <td>150,000 ₫</td>
                                                </tr>
                                                
                                                <!-- For users (7 columns) -->
                                                <tr th:if="${(reportData == null or #lists.isEmpty(reportData)) and reportType == 'users'}">
                                                    <td>1</td>
                                                    <td>Khách hàng mẫu</td>
                                                    <td>10</td>
                                                    <td>1,000,000 ₫</td>
                                                    <td>100,000 ₫</td>
                                                    <td>01/10/2025</td>
                                                    <td><span class="badge badge-info">Khách hàng mới</span></td>
                                                </tr>
                                                
                                                <!-- For null/undefined report type (5 columns) -->
                                                <tr th:if="${(reportData == null or #lists.isEmpty(reportData)) and reportType == null}">
                                                    <td>1</td>
                                                    <td>Dữ liệu mẫu</td>
                                                    <td>10</td>
                                                    <td>1,000,000 ₫</td>
                                                    <td>100,000 ₫</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- Chart for the report data -->
                                    <div class="mt-4">
                                        <div class="row mb-4">
                                            <div class="col-md-12">
                                                <div class="card">
                                                    <div class="card-header d-flex justify-content-between align-items-center">
                                                        <h4 class="card-title mb-0">Biểu đồ doanh thu</h4>
                                                        <div class="chart-type-container">
                                                            <button type="button" class="btn btn-circle chart-type active" data-type="bar" title="Biểu đồ cột">
                                                                <i class="fas fa-chart-bar"></i>
                                                            </button>
                                                            <button type="button" class="btn btn-circle chart-type" data-type="line" title="Biểu đồ đường">
                                                                <i class="fas fa-chart-line"></i>
                                                            </button>
                                                            <button type="button" class="btn btn-circle chart-type" data-type="pie" title="Biểu đồ tròn">
                                                                <i class="fas fa-chart-pie"></i>
                                                            </button>
                                                            <button type="button" class="btn btn-circle chart-type" data-type="doughnut" title="Biểu đồ vòng">
                                                                <i class="fas fa-circle-notch"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="card-body">
                                                        <canvas id="reportChart" style="height: 350px;"></canvas>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            
            <!-- Footer -->
            <th:block th:replace="~{admin/fragments/footer :: footer}"></th:block>
        </div>
    </div>
    
    <!-- Core JS Files -->
    <script src="/assets/js/core/jquery.3.2.1.min.js"></script>
    <script src="/assets/js/core/popper.min.js"></script>
    <script src="/assets/js/core/bootstrap.min.js"></script>
    
    <!-- jQuery UI -->
    <script src="/assets/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <script src="/assets/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>
    
    <!-- Animation Libraries -->
    <script src="https://unpkg.com/scrollreveal@4.0.9/dist/scrollreveal.min.js"></script>
    <script src="/js/dashboard-animations.js"></script>
    <script src="/js/chart-enhancements.js"></script>
    
    <script>
        // Thêm hiệu ứng cho các phần tử khi cuộn trang
        document.addEventListener('DOMContentLoaded', function() {
            // Cấu hình hiệu ứng ScrollReveal
            ScrollReveal().reveal('.dashboard-item', {
                duration: 1000,
                origin: 'bottom',
                distance: '20px',
                easing: 'ease-in-out',
                interval: 100
            });
            
            ScrollReveal().reveal('.card', {
                duration: 1200,
                delay: 200,
                origin: 'bottom',
                distance: '30px',
                easing: 'cubic-bezier(0.5, 0, 0, 1)'
            });
            
            // Thêm hiệu ứng cho các thành phần khác
            ScrollReveal().reveal('.chart-container', {
                duration: 1400,
                delay: 300,
                origin: 'bottom',
                distance: '40px',
                easing: 'cubic-bezier(0.5, 0, 0, 1)'
            });
            
            ScrollReveal().reveal('.comparison-table', {
                duration: 1000,
                delay: 250,
                origin: 'left',
                distance: '30px',
                easing: 'cubic-bezier(0.5, 0, 0, 1)'
            });
            
            // Khởi tạo các animation khác
            if (typeof animateDashboard === 'function') {
                animateDashboard();
            }
            
            if (typeof addChartGradients === 'function') {
                setTimeout(addChartGradients, 1000); // Delay để đảm bảo biểu đồ đã được tạo
            }
        });
    </script>
    
    <!-- jQuery Scrollbar -->
    <script src="/assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
    
    <!-- Chart JS -->
    <script src="/assets/js/plugin/chart.js/chart.min.js"></script>
    
    <!-- Datatables -->
    <script src="/assets/js/plugin/datatables/datatables.min.js"></script>
    
    <!-- Atlantis JS -->
    <script src="/assets/js/atlantis.min.js"></script>
    
    <!-- Advanced Revenue Statistics Features -->
    <script src="/js/revenue-stats-advanced.js"></script>
    <!-- Debug script for export functionality -->
    <script src="/js/export-debug.js"></script>
    
    <script>
    // Override export functions with improved versions
    function exportToExcelImproved() {
        try {
            console.log('Bắt đầu xuất Excel (improved version)...');
            
            // Kiểm tra thư viện XLSX
            if (typeof XLSX === 'undefined') {
                alert('Thư viện XLSX chưa được tải. Vui lòng thử lại sau.');
                return;
            }
            
            const table = document.getElementById('report-table');
            if (!table) {
                alert('Không tìm thấy bảng dữ liệu để xuất.');
                console.log('Available tables:', document.querySelectorAll('table'));
                return;
            }
            
            console.log('Tìm thấy bảng dữ liệu');
            
            // Kiểm tra xem bảng có dữ liệu không
            const rows = table.querySelectorAll('tbody tr');
            if (rows.length === 0) {
                alert('Bảng không có dữ liệu để xuất.');
                return;
            }
            
            console.log('Bảng có', rows.length, 'dòng dữ liệu');
            
            // Lấy tiêu đề báo cáo
            const reportTitleElement = document.querySelector('.card-title');
            const reportTitle = reportTitleElement ? reportTitleElement.textContent : 'Bao_Cao';
            const fileName = 'Bao_Cao_' + reportTitle.replace(/\s+/g, '_') + '_' + new Date().toISOString().slice(0,10) + '.xlsx';
            
            console.log('Tên file:', fileName);
            
            // Tạo workbook
            const ws = XLSX.utils.table_to_sheet(table);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Báo cáo");
            
            console.log('Bắt đầu tải xuống file Excel...');
            
            // Tải xuống file Excel
            XLSX.writeFile(wb, fileName);
            
            console.log('Xuất Excel thành công!');
            alert('Xuất file Excel thành công!');
            
        } catch (error) {
            console.error('Lỗi khi xuất Excel:', error);
            alert('Có lỗi xảy ra khi xuất file Excel: ' + error.message);
        }
    }
    
    function exportToPDFImproved() {
        try {
            console.log('Bắt đầu xuất PDF (improved version)...');
            
            // Kiểm tra thư viện jsPDF
            if (typeof window.jspdf === 'undefined') {
                alert('Thư viện jsPDF chưa được tải. Vui lòng thử lại sau.');
                return;
            }
            
            const table = document.getElementById('report-table');
            if (!table) {
                alert('Không tìm thấy bảng dữ liệu để xuất.');
                console.log('Available tables:', document.querySelectorAll('table'));
                return;
            }
            
            console.log('Tìm thấy bảng dữ liệu');
            
            // Kiểm tra xem bảng có dữ liệu không
            const rows = table.querySelectorAll('tbody tr');
            if (rows.length === 0) {
                alert('Bảng không có dữ liệu để xuất.');
                return;
            }
            
            console.log('Bảng có', rows.length, 'dòng dữ liệu');
            
            // Lấy tiêu đề báo cáo
            const reportTitleElement = document.querySelector('.card-title');
            const reportTitle = reportTitleElement ? reportTitleElement.textContent : 'Bao_Cao';
            const fileName = 'Bao_Cao_' + reportTitle.replace(/\s+/g, '_') + '_' + new Date().toISOString().slice(0,10) + '.pdf';
            
            console.log('Tên file:', fileName);
            
            // Tạo PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4');
            
            console.log('Tạo đối tượng jsPDF thành công');
            
            // Chuyển đổi tiêu đề và nội dung tiếng Việt sang dạng không dấu để tránh lỗi font
            const convertVietnameseText = (text) => {
                const vietnameseMap = {
                    'à': 'a', 'á': 'a', 'ạ': 'a', 'ả': 'a', 'ã': 'a',
                    'â': 'a', 'ầ': 'a', 'ấ': 'a', 'ậ': 'a', 'ẩ': 'a', 'ẫ': 'a',
                    'ă': 'a', 'ằ': 'a', 'ắ': 'a', 'ặ': 'a', 'ẳ': 'a', 'ẵ': 'a',
                    'è': 'e', 'é': 'e', 'ẹ': 'e', 'ẻ': 'e', 'ẽ': 'e',
                    'ê': 'e', 'ề': 'e', 'ế': 'e', 'ệ': 'e', 'ể': 'e', 'ễ': 'e',
                    'ì': 'i', 'í': 'i', 'ị': 'i', 'ỉ': 'i', 'ĩ': 'i',
                    'ò': 'o', 'ó': 'o', 'ọ': 'o', 'ỏ': 'o', 'õ': 'o',
                    'ô': 'o', 'ồ': 'o', 'ố': 'o', 'ộ': 'o', 'ổ': 'o', 'ỗ': 'o',
                    'ơ': 'o', 'ờ': 'o', 'ớ': 'o', 'ợ': 'o', 'ở': 'o', 'ỡ': 'o',
                    'ù': 'u', 'ú': 'u', 'ụ': 'u', 'ủ': 'u', 'ũ': 'u',
                    'ư': 'u', 'ừ': 'u', 'ứ': 'u', 'ự': 'u', 'ử': 'u', 'ữ': 'u',
                    'ỳ': 'y', 'ý': 'y', 'ỵ': 'y', 'ỷ': 'y', 'ỹ': 'y',
                    'đ': 'd', 'Đ': 'D',
                    'À': 'A', 'Á': 'A', 'Ạ': 'A', 'Ả': 'A', 'Ã': 'A',
                    'Â': 'A', 'Ầ': 'A', 'Ấ': 'A', 'Ậ': 'A', 'Ẩ': 'A', 'Ẫ': 'A',
                    'Ă': 'A', 'Ằ': 'A', 'Ắ': 'A', 'Ặ': 'A', 'Ẳ': 'A', 'Ẵ': 'A',
                    'È': 'E', 'É': 'E', 'Ẹ': 'E', 'Ẻ': 'E', 'Ẽ': 'E',
                    'Ê': 'E', 'Ề': 'E', 'Ế': 'E', 'Ệ': 'E', 'Ể': 'E', 'Ễ': 'E',
                    'Ì': 'I', 'Í': 'I', 'Ị': 'I', 'Ỉ': 'I', 'Ĩ': 'I',
                    'Ò': 'O', 'Ó': 'O', 'Ọ': 'O', 'Ỏ': 'O', 'Õ': 'O',
                    'Ô': 'O', 'Ồ': 'O', 'Ố': 'O', 'Ộ': 'O', 'Ổ': 'O', 'Ỗ': 'O',
                    'Ơ': 'O', 'Ờ': 'O', 'Ớ': 'O', 'Ợ': 'O', 'Ở': 'O', 'Ỡ': 'O',
                    'Ù': 'U', 'Ú': 'U', 'Ụ': 'U', 'Ủ': 'U', 'Ũ': 'U',
                    'Ư': 'U', 'Ừ': 'U', 'Ứ': 'U', 'Ự': 'U', 'Ử': 'U', 'Ữ': 'U',
                    'Ỳ': 'Y', 'Ý': 'Y', 'Ỵ': 'Y', 'Ỷ': 'Y', 'Ỹ': 'Y'
                };
                
                return text.replace(/[àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđĐÀÁẠẢÃÂẦẤẬẨẪĂẰẮẶẲẴÈÉẸẺẼÊỀẾỆỂỄÌÍỊỈĨÒÓỌỎÕÔỒỐỘỔỖƠỜỚỢỞỠÙÚỤỦŨƯỪỨỰỬỮỲÝỴỶỸ]/g, 
                    match => vietnameseMap[match] || match);
            };
            
            // Thêm tiêu đề (chuyển đổi tiếng Việt)
            const convertedTitle = convertVietnameseText(reportTitle);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.text(convertedTitle, doc.internal.pageSize.getWidth() / 2, 20, { align: 'center' });
            
            // Thêm ngày xuất báo cáo
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.text('Ngay xuat bao cao: ' + new Date().toLocaleDateString('vi-VN'), doc.internal.pageSize.getWidth() / 2, 27, { align: 'center' });
            
            console.log('Thêm tiêu đề thành công');
            
            // Tạo bảng tạm thời với nội dung đã chuyển đổi
            const originalTable = document.getElementById('report-table');
            const tempTable = originalTable.cloneNode(true);
            
            // Chuyển đổi nội dung trong bảng
            const allCells = tempTable.querySelectorAll('th, td');
            allCells.forEach(cell => {
                if (cell.textContent) {
                    cell.textContent = convertVietnameseText(cell.textContent);
                }
            });
            
            // Thêm bảng tạm vào DOM để autoTable có thể đọc
            tempTable.style.display = 'none';
            tempTable.id = 'temp-report-table';
            document.body.appendChild(tempTable);
            
            // Chuyển đổi bảng sang PDF
            doc.autoTable({
                html: '#temp-report-table',
                startY: 35,
                styles: {
                    fontSize: 9,
                    cellPadding: 2,
                    overflow: 'linebreak',
                    font: 'helvetica',
                    textColor: [0, 0, 0]
                },
                headStyles: {
                    fillColor: [41, 128, 185],
                    textColor: [255, 255, 255],
                    fontStyle: 'bold',
                    fontSize: 10
                },
                alternateRowStyles: {
                    fillColor: [245, 245, 245]
                },
                margin: { top: 35, bottom: 20, left: 10, right: 10 },
                didDrawPage: function(data) {
                    // Thêm số trang
                    const pageNumber = data.pageNumber;
                    const totalPages = doc.internal.getNumberOfPages();
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(8);
                    doc.text('Trang ' + pageNumber + '/' + totalPages, 20, doc.internal.pageSize.getHeight() - 10);
                }
            });
            
            // Xóa bảng tạm
            document.body.removeChild(tempTable);
            
            console.log('Tạo bảng PDF thành công');
            
            // Lưu file PDF
            doc.save(fileName);
            
            console.log('Xuất PDF thành công!');
            alert('Xuất file PDF thành công!');
            
        } catch (error) {
            console.error('Lỗi khi xuất PDF:', error);
            alert('Có lỗi xảy ra khi xuất file PDF: ' + error.message);
        }
    }
    
    function exportToPDFAsImage() {
        try {
            console.log('Bắt đầu xuất PDF bằng hình ảnh...');
            
            // Kiểm tra thư viện
            if (typeof window.jspdf === 'undefined' || typeof html2canvas === 'undefined') {
                alert('Thư viện jsPDF hoặc html2canvas chưa được tải. Vui lòng thử lại sau.');
                return;
            }
            
            const table = document.getElementById('report-table');
            if (!table) {
                alert('Không tìm thấy bảng dữ liệu để xuất.');
                return;
            }
            
            const rows = table.querySelectorAll('tbody tr');
            if (rows.length === 0) {
                alert('Bảng không có dữ liệu để xuất.');
                return;
            }
            
            // Tạo container cho việc chụp ảnh
            const container = document.createElement('div');
            container.style.background = 'white';
            container.style.padding = '20px';
            container.style.fontFamily = 'Arial, sans-serif';
            
            // Lấy tiêu đề báo cáo
            const reportTitleElement = document.querySelector('.card-title');
            const reportTitle = reportTitleElement ? reportTitleElement.textContent : 'Báo cáo';
            
            // Thêm tiêu đề
            const titleDiv = document.createElement('div');
            titleDiv.innerHTML = `
                <h2 style="text-align: center; margin-bottom: 10px; color: #333;">${reportTitle}</h2>
                <p style="text-align: center; color: #666; margin-bottom: 20px;">Ngày xuất báo cáo: ${new Date().toLocaleDateString('vi-VN')}</p>
            `;
            container.appendChild(titleDiv);
            
            // Clone bảng
            const tableClone = table.cloneNode(true);
            tableClone.style.width = '100%';
            tableClone.style.border = '1px solid #ddd';
            tableClone.style.borderCollapse = 'collapse';
            
            // Styling cho bảng
            const headers = tableClone.querySelectorAll('th');
            headers.forEach(th => {
                th.style.backgroundColor = '#2980b9';
                th.style.color = 'white';
                th.style.padding = '10px';
                th.style.border = '1px solid #ddd';
                th.style.textAlign = 'center';
            });
            
            const cells = tableClone.querySelectorAll('td');
            cells.forEach(td => {
                td.style.padding = '8px';
                td.style.border = '1px solid #ddd';
                td.style.textAlign = 'center';
            });
            
            container.appendChild(tableClone);
            
            // Thêm container tạm thời vào body
            container.style.position = 'absolute';
            container.style.left = '-9999px';
            container.style.top = '0';
            document.body.appendChild(container);
            
            // Chụp ảnh
            html2canvas(container, {
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff',
                width: 800,
                height: container.offsetHeight
            }).then(canvas => {
                // Xóa container tạm
                document.body.removeChild(container);
                
                // Tạo PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('l', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 277; // A4 landscape width - margins
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // Thêm hình ảnh vào PDF
                doc.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
                
                // Thêm footer
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.text('© OneShop ' + new Date().getFullYear(), 10, doc.internal.pageSize.getHeight() - 5);
                
                const fileName = 'Bao_Cao_' + reportTitle.replace(/\s+/g, '_') + '_' + new Date().toISOString().slice(0,10) + '.pdf';
                doc.save(fileName);
                
                console.log('Xuất PDF bằng hình ảnh thành công!');
                alert('Xuất file PDF thành công (với font tiếng Việt đẹp)!');
                
            }).catch(error => {
                document.body.removeChild(container);
                console.error('Lỗi khi chụp ảnh:', error);
                alert('Có lỗi xảy ra khi chụp ảnh: ' + error.message);
            });
            
        } catch (error) {
            console.error('Lỗi khi xuất PDF bằng hình ảnh:', error);
            alert('Có lỗi xảy ra: ' + error.message);
        }
    }
    
    // Thêm event listeners cho các nút mới
    document.addEventListener('DOMContentLoaded', function() {
        const pdfTextBtn = document.getElementById('export-pdf-text');
        const pdfImageBtn = document.getElementById('export-pdf-image');
        
        if (pdfTextBtn) {
            pdfTextBtn.addEventListener('click', function(e) {
                e.preventDefault();
                exportToPDFImproved();
            });
        }
        
        if (pdfImageBtn) {
            pdfImageBtn.addEventListener('click', function(e) {
                e.preventDefault();
                exportToPDFAsImage();
            });
        }
    });
    
    // Override original functions
    window.exportToExcel = exportToExcelImproved;
    window.exportToPDF = exportToPDFImproved; // Mặc định vẫn là text
    window.exportToPDFAsImage = exportToPDFAsImage;
    </script>
    
    <!-- Custom Charts JS -->
    <script th:if="${reportData == null}">
        // Revenue chart for the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch dữ liệu doanh thu theo tháng từ API
            fetch('/admin/api/monthly-revenue-data')
                .then(response => response.json())
                .then(data => {
                    console.log('Dữ liệu doanh thu:', data);
                    // Sau khi có dữ liệu, vẽ biểu đồ với dữ liệu revenues từ API
                    if (data && data.revenues) {
                        drawRevenueChart(data.revenues);
                    } else {
                        console.error('Dữ liệu API không đúng định dạng:', data);
                        var defaultData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                        drawRevenueChart(defaultData);
                    }
                })
                .catch(error => {
                    console.error('Lỗi khi tải dữ liệu doanh thu:', error);
                    // Nếu có lỗi, sử dụng dữ liệu mặc định
                    var defaultData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                    drawRevenueChart(defaultData);
                });
            
            // Hàm vẽ biểu đồ doanh thu
            function drawRevenueChart(revenueData) {
                var ctx = document.getElementById('revenueChart').getContext('2d');
                
                // Lấy loại biểu đồ từ nút đã chọn
                var activeButton = document.querySelector('.chart-type.active');
                var chartType = activeButton ? activeButton.getAttribute('data-type') : 'bar';
                
                // Log dữ liệu để debug
                console.log('Dữ liệu doanh thu cho biểu đồ:', revenueData);
                
                // Đảm bảo revenueData là một mảng
                if (!Array.isArray(revenueData)) {
                    console.error('Dữ liệu không phải là mảng, sử dụng dữ liệu mặc định');
                    revenueData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                }
                
                // Tạo biểu đồ với dữ liệu thực từ API
                var gradientFill = ctx.createLinearGradient(0, 0, 0, 400);
                gradientFill.addColorStop(0, 'rgba(54, 162, 235, 0.8)');
                gradientFill.addColorStop(1, 'rgba(54, 162, 235, 0.1)');

                window.revenueChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
                        datasets: [{
                            label: 'Doanh thu theo tháng',
                            data: revenueData,
                            backgroundColor: gradientFill,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                borderDash: [5, 5]
                            },
                            ticks: {
                                font: {
                                    size: 11
                                },
                                padding: 10,
                                callback: function(value) {
                                    return value.toLocaleString('vi-VN') + ' ₫';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 11
                                },
                                padding: 5
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw.toLocaleString('vi-VN') + ' ₫';
                                }
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            titleFont: {
                                size: 13,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 12
                            },
                            padding: 12,
                            cornerRadius: 6,
                            displayColors: true
                        },
                        legend: {
                            display: false
                        }
                    },
                    animation: {
                        duration: 1200,
                        easing: 'easeOutQuart'
                    }
                }
                });
            }
        });
    </script>
    
    <script th:if="${reportData != null}">
        // Chart for report data
        document.addEventListener('DOMContentLoaded', function() {
            var ctx = document.getElementById('reportChart').getContext('2d');
            var labels = [];
            var data = [];
            var backgroundColor = [];
            
            // Variables for summary statistics
            var totalItems = 0;
            var totalRevenue = 0;
            var totalQuantity = 0;
            var avgPrice = 0;
            
            // Generate colors
            function generateColors(count) {
                var colors = [];
                for (var i = 0; i < count; i++) {
                    var hue = (360 / count) * i;
                    colors.push('hsla(' + hue + ', 70%, 60%, 0.7)');
                }
                return colors;
            }
            
            // Extract data from the table
            var table = document.querySelector('table');
            var rows = table.querySelectorAll('tbody tr');
            var reportType = '[[${reportType}]]';
            
            console.log('Processing report type:', reportType);
            console.log('Total rows:', rows.length);
            
            rows.forEach(function(row, index) {
                // Skip empty rows or sample data rows
                if (row.cells.length < 3) return;
                
                var label, revenueValue, quantityValue;
                
                // All report types now have the same structure after rendering:
                // Column 0: # (index)
                // Column 1: Name/Period (formatted)
                // Column 2: Quantity (for categories/brands/months/quarters/years) or Orders (for users)
                // Column 3: Revenue/Total Spent
                // Column 4+: Additional fields
                
                label = row.cells[1].textContent.trim();
                
                // Parse quantity (remove thousand separators)
                var quantityText = row.cells[2].textContent.trim().replace(/\./g, '').replace(/,/g, '');
                quantityValue = parseFloat(quantityText) || 0;
                
                // Parse revenue (remove currency symbol and thousand separators)
                var revenueText = row.cells[3].textContent.trim().replace(' ₫', '').replace(/₫/g, '').replace(/\./g, '').replace(/,/g, '');
                revenueValue = parseFloat(revenueText) || 0;
                
                console.log('Row ' + index + ':', {
                    label: label,
                    quantityText: row.cells[2].textContent.trim(),
                    quantityValue: quantityValue,
                    revenueText: row.cells[3].textContent.trim(),
                    revenueValue: revenueValue
                });
                
                // Add to chart data
                labels.push(label);
                data.push(revenueValue);
                
                // Calculate summary statistics
                totalItems++;
                if (!isNaN(revenueValue)) {
                    totalRevenue += revenueValue;
                }
                if (!isNaN(quantityValue)) {
                    totalQuantity += quantityValue;
                }
            });
            
            // Calculate average price/value
            if (reportType === 'users') {
                // For users report: average = total revenue / total orders (not total customers)
                if (totalQuantity > 0) {
                    avgPrice = totalRevenue / totalQuantity;
                }
            } else {
                // For other reports: average = total revenue / total items
                if (totalItems > 0) {
                    avgPrice = totalRevenue / totalItems;
                }
            }
            
            // Update summary cards
            document.getElementById('summary-total-items').textContent = totalItems.toLocaleString('vi-VN');
            document.getElementById('summary-total-revenue').textContent = totalRevenue.toLocaleString('vi-VN') + ' ₫';
            document.getElementById('summary-total-quantity').textContent = totalQuantity.toLocaleString('vi-VN');
            document.getElementById('summary-avg-price').textContent = avgPrice.toLocaleString('vi-VN') + ' ₫';
            
            console.log('=== Summary Statistics ===');
            console.log('Total Items:', totalItems);
            console.log('Total Revenue:', totalRevenue);
            console.log('Total Quantity:', totalQuantity);
            console.log('Average Price:', avgPrice);
            
            backgroundColor = generateColors(labels.length);
            
            var reportChart;
            var chartType = 'bar';
            
            // For years, months, quarters, use a line chart
            if (['years', 'months', 'quarters'].includes('[[${reportType}]]')) {
                chartType = 'line';
            }
            
            // Create gradient background
            var gradientFill = ctx.createLinearGradient(0, 0, 0, 400);
            gradientFill.addColorStop(0, 'rgba(54, 162, 235, 0.8)');
            gradientFill.addColorStop(1, 'rgba(54, 162, 235, 0.1)');
            
            reportChart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: '[[${reportTitle}]]',
                        data: data,
                        backgroundColor: chartType === 'bar' ? gradientFill : backgroundColor,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                borderDash: [5, 5]
                            },
                            ticks: {
                                font: {
                                    size: 11
                                },
                                padding: 10,
                                callback: function(value) {
                                    return value.toLocaleString('vi-VN') + ' ₫';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 11
                                },
                                padding: 5
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw.toLocaleString('vi-VN') + ' ₫';
                                }
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            titleFont: {
                                size: 13,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 12
                            },
                            padding: 12,
                            cornerRadius: 6,
                            displayColors: true
                        },
                        legend: {
                            display: chartType === 'pie' || chartType === 'doughnut',
                            position: 'top',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        }
                    },
                    animation: {
                        duration: 1200,
                        easing: 'easeOutQuart'
                    }
                }
            });
            
            // Save reference to the chart
            window.reportChartInstance = reportChart;
            
            // Setup chart type buttons
            const chartTypeButtons = document.querySelectorAll('.chart-type-container .chart-type');
            if (chartTypeButtons.length > 0) {
                // Set initial active state based on chart type
                chartTypeButtons.forEach(btn => {
                    if (btn.getAttribute('data-type') === chartType) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
            
            // Initialize DataTables
            $(document).ready(function() {
                $('.table').DataTable({
                    "pageLength": 10,
                    "language": {
                        "url": "//cdn.datatables.net/plug-ins/1.10.25/i18n/Vietnamese.json"
                    }
                });
            });
        });
    </script>
</body>
</html>