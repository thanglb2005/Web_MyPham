<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title th:text="${pageTitle}">Quản lý shop</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    body {
      background-color: #f8fafc;
      color: #0f172a;
    }
    .admin-header {
      background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
      color: #fff;
      border-radius: 18px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 18px 36px rgba(14, 165, 233, 0.35);
    }
    .filter-card, .table-card {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
      border: 1px solid rgba(148, 163, 184, 0.15);
    }
    .status-badge {
      border-radius: 999px;
      padding: 0.35rem 0.75rem;
      font-size: 0.8rem;
      font-weight: 600;
    }
  </style>
</head>
<body>
<div class="container-fluid py-4">
  <header class="admin-header">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
      <div>
        <h1 class="h4 mb-1">Quản lý shop</h1>
        <p class="mb-0 text-white-50">Xem danh sách shop đăng ký và cập nhật trạng thái duyệt.</p>
      </div>
      <a class="btn btn-outline-light" th:href="@{/admin/home}">
        <i class="fas fa-home me-2"></i>Trang chủ admin
      </a>
    </div>
  </header>

  <section class="filter-card p-4 mb-4">
    <form class="row g-3 align-items-center" method="get" th:action="@{/admin/shops}">
      <div class="col-md-4">
        <label class="form-label" for="status">Lọc theo trạng thái</label>
        <select id="status" name="status" class="form-select">
          <option value="" th:selected="${selectedStatus == 'ALL'}">Tất cả</option>
          <option th:each="state : ${statuses}"
                  th:value="${state.name()}"
                  th:text="${state.name()}"
                  th:selected="${selectedStatus == state.name()}"></option>
        </select>
      </div>
      <div class="col-md-2 d-flex gap-2">
        <button type="submit" class="btn btn-primary flex-grow-1"><i class="fas fa-filter me-2"></i>Lọc</button>
        <a class="btn btn-outline-secondary" th:href="@{/admin/shops}"><i class="fas fa-undo me-1"></i>Đặt lại</a>
      </div>
    </form>
  </section>

  <section class="table-card p-0">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light text-uppercase small text-secondary">
        <tr>
          <th>ID</th>
          <th>Tên shop</th>
          <th>Vendor</th>
          <th>Thông tin liên hệ</th>
          <th>Trạng thái</th>
          <th class="text-end">Sản phẩm</th>
          <th class="text-end">Doanh thu</th>
          <th class="text-center">Hành động</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${shops == null || #lists.isEmpty(shops)}">
          <td colspan="8" class="text-center py-4">Chưa có shop nào.</td>
        </tr>
        <tr th:each="shop : ${shops}">
          <td th:text="${shop.shopId}">1</td>
          <td>
            <div class="fw-semibold" th:text="${shop.shopName}">Tên shop</div>
            <div class="text-muted small" th:text="${shop.shopSlug}">shop-slug</div>
          </td>
          <td>
            <div th:text="${shop.vendor != null ? shop.vendor.name : '---'}">Vendor</div>
            <div class="text-muted small" th:text="${shop.vendor != null ? shop.vendor.email : ''}"></div>
          </td>
          <td>
            <div th:text="${shop.phoneNumber != null ? shop.phoneNumber : '---'}"></div>
            <div class="text-muted small" th:text="${shop.address}">Địa chỉ</div>
          </td>
          <td>
            <span class="status-badge bg-success-subtle text-success" th:if="${shop.status.equals(T(vn.entity.Shop$ShopStatus).ACTIVE)}">Hoạt động</span>
            <span class="status-badge bg-warning-subtle text-warning" th:if="${shop.status.equals(T(vn.entity.Shop$ShopStatus).PENDING)}">Chờ duyệt</span>
            <span class="status-badge bg-danger-subtle text-danger" th:if="${shop.status.equals(T(vn.entity.Shop$ShopStatus).SUSPENDED)}">Tạm khóa</span>
            <span class="status-badge bg-secondary-subtle text-secondary" th:if="${shop.status.equals(T(vn.entity.Shop$ShopStatus).REJECTED)}">Từ chối</span>
          </td>
          <td class="text-end" th:text="${shop.totalProducts}">0</td>
          <td class="text-end" th:text="${#numbers.formatDecimal(shop.totalRevenue, 0, 'DEFAULT', 0, 'DEFAULT')} + ' ₫'">0 ₫</td>
          <td class="text-center">
            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" th:data-bs-target="'#shopStatusModal' + ${shop.shopId}">
              <i class="fas fa-edit me-1"></i>Cập nhật
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </section>

  <div th:each="shop : ${shops}">
    <div class="modal fade" th:id="'shopStatusModal' + ${shop.shopId}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Cập nhật trạng thái: <span th:text="${shop.shopName}">Shop</span></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form th:action="@{'/admin/shops/' + ${shop.shopId} + '/status'}" method="post">
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label" for="statusSelect" th:for="'statusSelect' + ${shop.shopId}">Trạng thái</label>
                <select class="form-select" th:id="'statusSelect' + ${shop.shopId}" name="status">
                  <option th:each="state : ${statuses}"
                          th:value="${state.name()}"
                          th:text="${state.name()}"
                          th:selected="${state == shop.status}"></option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label" th:for="'reason' + ${shop.shopId}">Lý do (nếu từ chối)</label>
                <textarea class="form-control" rows="3" name="reason" th:id="'reason' + ${shop.shopId}"
                          th:text="${shop.rejectionReason}"></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Hủy</button>
              <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
