<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title th:text="${pageTitle}">Quản lý sản phẩm</title>
  <link rel="stylesheet" th:href="@{/vendor/bootstrap/bootstrap.min.css}" />
  <link rel="stylesheet" th:href="@{/fonts/fontawesome/fontawesome.min.css}" />
  <link rel="stylesheet" th:href="@{/css/main.css}" />
  <link rel="stylesheet" th:href="@{/css/vendor.css}" />
  <style>
    body {
      background-color: #f3f4f6;
    }
    .vendor-section {
      background: #fff;
      border-radius: 18px;
      padding: 32px;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.1);
      border: 1px solid rgba(15, 23, 42, 0.06);
      max-width: 920px;
      margin: 0 auto;
    }
    .form-label {
      font-weight: 600;
      color: #1f2937;
    }
    .form-control,
    .form-select {
      border-radius: 14px;
      padding: 0.65rem 0.9rem;
    }
    .field-hint {
      font-size: 0.85rem;
      color: #6b7280;
    }
    .error-text {
      color: #dc2626;
      font-size: 0.85rem;
      margin-top: 0.25rem;
    }
    .image-preview {
      width: 110px;
      height: 110px;
      border-radius: 16px;
      object-fit: cover;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }
  </style>
</head>
<body class="bg-light">
  <div th:replace="~{vendor/fragments/nav :: vendorNav('products')}"></div>

  <main class="container py-4">
    <section class="vendor-section">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="h4 mb-1" th:text="${product != null} ? 'Cập nhật sản phẩm' : 'Thêm sản phẩm mới'">Thêm sản phẩm</h1>
          <p class="text-muted mb-0" th:text="${shop.shopName}">Tên shop</p>
        </div>
        <a class="btn btn-outline-secondary" th:href="@{'/vendor/products'(shopId=${selectedShopId})}">
          <i class="fas fa-arrow-left me-2"></i>Quay lại danh sách
        </a>
      </div>

      <form th:action="${product != null} ? @{'/vendor/products/update?id=' + ${product.productId} + '&shopId=' + ${selectedShopId}} : @{/vendor/products}"
            th:object="${productForm}"
            method="post"
            enctype="multipart/form-data"
            class="row g-4">

        <div class="col-md-6" th:if="${product == null}">
          <label class="form-label" for="shopId">Chọn shop *</label>
          <select id="shopId" class="form-select" th:field="*{shopId}">
            <option value="" disabled th:selected="${productForm == null or productForm.shopId == null}">Chọn shop</option>
            <option th:each="ownedShop : ${shopList}"
                    th:value="${ownedShop.shopId}"
                    th:text="${ownedShop.shopName}">
            </option>
          </select>
          <div class="error-text" th:if="${#fields.hasErrors('shopId')}" th:errors="*{shopId}"></div>
        </div>

        <div class="col-md-6" th:if="${product != null}">
          <label class="form-label">Shop</label>
          <input type="hidden" th:field="*{shopId}" />
          <input type="text" class="form-control" th:value="${shop.shopName}" readonly />
        </div>

        <div class="col-md-6" th:if="${product == null}">
          <div class="form-text text-muted">Bạn có thể đổi sang shop khác bằng cách quay lại danh sách.</div>
        </div>

        <div class="col-md-6">
          <label class="form-label" for="productName">Tên sản phẩm *</label>
          <input id="productName" type="text" class="form-control" th:field="*{productName}" placeholder="Nhập tên sản phẩm" />
          <div class="error-text" th:if="${#fields.hasErrors('productName')}" th:errors="*{productName}"></div>
        </div>

        <div class="col-md-3">
          <label class="form-label" for="price">Giá bán *</label>
          <input id="price" type="number" min="0" step="1000" class="form-control" th:field="*{price}" placeholder="0" />
          <div class="error-text" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></div>
        </div>

        <div class="col-md-3">
          <label class="form-label" for="discount">Giảm giá (%)</label>
          <input id="discount" type="number" min="0" max="90" class="form-control" th:field="*{discount}" placeholder="0" />
          <div class="error-text" th:if="${#fields.hasErrors('discount')}" th:errors="*{discount}"></div>
        </div>

        <div class="col-md-3">
          <label class="form-label" for="quantity">Tồn kho *</label>
          <input id="quantity" type="number" min="0" class="form-control" th:field="*{quantity}" placeholder="0" />
          <div class="error-text" th:if="${#fields.hasErrors('quantity')}" th:errors="*{quantity}"></div>
        </div>

        <div class="col-md-3">
          <label class="form-label" for="categoryId">Danh mục *</label>
          <select id="categoryId" class="form-select" th:field="*{categoryId}">
            <option value="" disabled th:selected="${productForm == null or productForm.categoryId == null}">Chọn danh mục</option>
            <option th:each="category : ${categories}"
                    th:value="${category.categoryId}"
                    th:text="${category.categoryName}"></option>
          </select>
          <div class="error-text" th:if="${#fields.hasErrors('categoryId')}" th:errors="*{categoryId}"></div>
        </div>

        <div class="col-md-3">
          <label class="form-label" for="brandId">Thương hiệu *</label>
          <select id="brandId" class="form-select" th:field="*{brandId}">
            <option value="" disabled th:selected="${productForm == null or productForm.brandId == null}">Chọn thương hiệu</option>
            <option th:each="brand : ${brands}"
                    th:value="${brand.brandId}"
                    th:text="${brand.brandName}"></option>
          </select>
          <div class="error-text" th:if="${#fields.hasErrors('brandId')}" th:errors="*{brandId}"></div>
        </div>

        <div class="col-md-6">
          <label class="form-label" for="image">Hình ảnh sản phẩm</label>
          <input id="image" type="file" class="form-control" name="image" accept="image/*" />
          <p class="field-hint mb-0">Định dạng: JPG, PNG hoặc WEBP.</p>
          <div class="error-text" th:if="${#fields.hasErrors('productName')}" th:errors="*{productName}"></div>
        </div>

        <div class="col-md-6" th:if="${product != null && product.productImage != null}">
          <label class="form-label">Xem trước hình ảnh</label>
          <div>
            <img class="image-preview" th:src="@{'/loadImage?imageName=' + ${product.productImage}}" alt="Ảnh sản phẩm" />
          </div>
        </div>

        <div class="col-12">
          <label class="form-label" for="description">Mô tả sản phẩm</label>
          <textarea id="description" class="form-control" rows="4" th:field="*{description}" placeholder="Mô tả chi tiết sản phẩm của bạn..."></textarea>
        </div>

        <div class="col-12">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="active" th:field="*{active}" />
            <label class="form-check-label" for="active">Hiển thị sản phẩm trên cửa hàng</label>
          </div>
        </div>

        <div class="col-12 d-flex justify-content-end gap-2">
          <a class="btn btn-outline-secondary" th:href="@{'/vendor/products'(shopId=${selectedShopId})}">Hủy bỏ</a>
          <button type="submit" class="btn btn-primary" th:text="${product != null} ? 'Lưu thay đổi' : 'Tạo sản phẩm'">Lưu</button>
        </div>
      </form>
    </section>
  </main>

  <script th:src="@{/vendor/bootstrap/jquery-3.6.0.min.js}"></script>
  <script th:src="@{/vendor/bootstrap/bootstrap.bundle.min.js}"></script>
</body>
</html>
