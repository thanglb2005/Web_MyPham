<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kho voucher - OneShop</title>
    <link rel="stylesheet" href="/fonts/flaticon/flaticon.css" />
    <link rel="stylesheet" href="/fonts/icofont/icofont.min.css" />
    <link rel="stylesheet" href="/fonts/fontawesome/fontawesome.min.css" />
    <link rel="stylesheet" href="/vendor/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/user-vouchers.css}" />
  </head>
  <body>
    <header th:replace="~{/web/fragments/header :: header}"></header>

    <main class="voucher-page">
      

      <section class="voucher-filter container" th:if="${totalVoucherCount > 0}">
        <div class="simple-filter">
          <button class="sf-btn active" data-target="all">
            Tất cả (<span th:text="${totalVoucherCount}">0</span>)
          </button>
          <button class="sf-btn" data-target="system" th:if="${systemVoucherCount > 0}">
            One Voucher (<span th:text="${systemVoucherCount}">0</span>)
          </button>
          <button class="sf-btn" data-target="shop" th:if="${shopVoucherCount > 0}">
            Shop Voucher (<span th:text="${shopVoucherCount}">0</span>)
          </button>
        </div>
      </section>

      <section class="voucher-content container">
        <div class="empty-state" th:if="${totalVoucherCount == 0}">
          <i class="fa-solid fa-ticket-simple empty-icon"></i>
          <h2>Hiện chưa có voucher nào</h2>
          <p>Giỏ hàng của bạn sẽ tiết kiệm hơn khi sưu tầm voucher từ các shop yêu thích.</p>
          <a class="btn btn-primary" href="/" role="button">Khám phá sản phẩm</a>
        </div>

        <!-- System Vouchers Section -->
        <div class="voucher-section one-section" th:if="${systemVouchers != null and !systemVouchers.isEmpty()}">
          <div class="section-min">
            <div class="section-min-title">One Voucher</div>
            <div class="section-min-sub">Áp dụng toàn hệ thống</div>
          </div>
          <div class="voucher-list-container">
            <div
              class="voucher-card-horizontal"
              th:each="voucher : ${systemVouchers}"
              th:attr="data-expiring=${voucher.expiringSoon}, data-remaining=${voucher.remainingUses}, data-type='system'"
            >
              <!-- Left Icon Section -->
              <div class="voucher-icon-section">
                <div class="voucher-icon one-shop-icon">
                  <img th:src="@{/images/icon.png}" alt="OneShop" class="oneshop-logo" />
                </div>
                <div class="voucher-source">ONESHOP</div>
              </div>

              <!-- Middle Info Section -->
              <div class="voucher-info-section">
                <div class="voucher-discount-text" th:text="${voucher.discountLabel}">Giảm 15%</div>
                <div class="voucher-condition" th:text="${voucher.minimumOrderLabel}">Đơn Tối Thiểu 0đ</div>
                <div class="voucher-expiry">
                  <i class="icofont-clock-time"></i>
                  <span>HSD: <span th:text="${voucher.expiryLabel}">31/12/2025 23:59</span></span>
                  <a href="#" class="link-detail">Điều kiện</a>
                </div>
                <div class="voucher-badges">
                  <span class="badge-live" th:if="${voucher.expiringSoon}">
                    <i class="fa-solid fa-hourglass-half"></i>
                    Sắp hết hạn
                  </span>
                </div>
              </div>

              <!-- Right Action Section -->
              <div class="voucher-action-section">
                <a href="/cart" class="btn-apply">Áp dụng</a>
                <div class="voucher-code-display">
                  Mã: <strong th:text="${voucher.promotionCode}">ONESHOP20</strong>
                  <button
                    class="btn-copy-code"
                    type="button"
                    th:attr="data-code=${voucher.promotionCode}"
                    title="Sao chép"
                  >
                    <i class="fa-solid fa-copy"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Shop Vouchers Section -->
        <div class="voucher-section shop-section" th:if="${voucherGroups != null and !voucherGroups.isEmpty()}">
          <div class="section-min">
            <div class="section-min-title">Shop Voucher</div>
            <div class="section-min-sub">Áp dụng theo cửa hàng</div>
          </div>
          <div class="voucher-list-container">
            <th:block th:each="group : ${voucherGroups}">
              <div
                class="voucher-card-horizontal"
                th:each="voucher : ${group.vouchers}"
                th:attr="data-expiring=${voucher.expiringSoon}, data-remaining=${voucher.remainingUses}, data-type='shop', data-shop=${group.shopName}"
              >
                <!-- Left Icon Section -->
                <div class="voucher-icon-section">
                  <div class="voucher-icon shop-icon">
                    <img
                      th:if="${group.shopLogo != null}"
                      th:src="@{'/loadImage?imageName=' + ${group.shopLogo}}"
                      alt="Shop logo"
                      class="shop-logo-img"
                      onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                    />
                    <div class="shop-logo-fallback" th:text="${#strings.substring(group.shopName,0,1)}">S</div>
                  </div>
                  <div class="voucher-source" th:text="${group.shopName}">Shop Name</div>
                </div>

                <!-- Middle Info Section -->
                <div class="voucher-info-section">
                  <div class="voucher-discount-text" th:text="${voucher.discountLabel}">Giảm 15%</div>
                  <div class="voucher-condition" th:text="${voucher.minimumOrderLabel}">Đơn Tối Thiểu 0đ</div>
                  <div class="voucher-expiry">
                    <i class="icofont-clock-time"></i>
                    <span>HSD: <span th:text="${voucher.expiryLabel}">31/12/2025 23:59</span></span>
                    <a href="#" class="link-detail" th:attr="onclick=|event.preventDefault(); alert('${voucher.promotionName}\n${voucher.minimumOrderLabel}\n${voucher.maximumDiscountLabel}');|">Điều kiện</a>
                  </div>
                  <div class="voucher-badges">
                    <span class="badge-live" th:if="${voucher.expiringSoon}">
                      <i class="fa-solid fa-hourglass-half"></i>
                      Sắp hết hạn
                    </span>
                  </div>
                </div>

                <!-- Right Action Section -->
                <div class="voucher-action-section">
                  <a th:href="@{${group.shopUrl}}" class="btn-apply">Áp dụng</a>
                  <div class="voucher-code-display">
                    Mã: <strong th:text="${voucher.promotionCode}">SHOP20</strong>
                    <button
                      class="btn-copy-code"
                      type="button"
                      th:attr="data-code=${voucher.promotionCode}"
                      title="Sao chép"
                    >
                      <i class="fa-solid fa-copy"></i>
                    </button>
                  </div>
                </div>
              </div>
            </th:block>
          </div>
        </div>
      </section>
    </main>

    <footer th:replace="~{/web/fragments/footer :: footer}"></footer>
    <script src="/vendor/bootstrap/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/user-vouchers.js}"></script>
  </body>
</html>
